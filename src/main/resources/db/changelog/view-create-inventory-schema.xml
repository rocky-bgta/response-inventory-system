<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">



    <changeSet id="04" author="Salahin Rocky">

        <createView replaceIfExists="true"
                    schemaName="inventory"
                    viewName="sales_product_view">
            SELECT P
            .ID as productId,
            sip.store_id as storeId,
            count(sip.product_id) as available,
            P.NAME as productName,
            cat.name as categoryName,
            brn.name as brandName,
            P.model_no as modelNo,
            sip.price as buyPrice,
            P.description,
            P.barcode,
            P.image
            FROM
            inventory.store_in_product sip
            INNER JOIN inventory.product P ON P.ID = sip.product_id
            INNER JOIN inventory.category cat ON p.category_id = cat.id
            INNER JOIN inventory.brand brn ON p.brand_id = brn.id
            GROUP BY
            P.id ,
            p."name",
            cat.name,
            brn.name,
            p.model_no,
            sip.price,
            p.description,
            p.barcode,
            p.image,
            sip.store_id

            ORDER BY
            sip.store_id

        </createView>

    </changeSet>
</databaseChangeLog>
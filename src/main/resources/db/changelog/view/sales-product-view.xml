<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">



    <changeSet id="04" author="Salahin Rocky">

        <createView replaceIfExists="true"
                    schemaName="inventory"
                    viewName="sales_product_view">
            SELECT  sale_product_view.product_id,
            sale_product_view.store_id,
            sale_product_view.available,
            sale_product_view.product_name,
            sale_product_view.category_name,
            sale_product_view.category_id,
            sale_product_view.brand_name,
            sale_product_view.model_no,
            sale_product_view.buy_price,
            sale_product_view.sale_price,
            sale_product_view.description,
            sale_product_view.barcode,
            sale_product_view.image
            FROM (SELECT sip
            .product_id,
            sip.store_id AS store_id,
            COUNT ( sip.product_id ) AS available,
            P.NAME AS product_name,
            cat.NAME AS category_name,
            cat.id AS category_id,
            brn.NAME AS brand_name,
            P.model_no,
            sip.price AS buy_price,
            p.sale_price,
            P.description,
            P.barcode,
            P.image
            FROM
            inventory.store_in_product sip
            LEFT JOIN inventory.product P ON  sip.product_id = P.ID
            LEFT JOIN inventory.category cat ON P.category_id = cat.ID
            LEFT JOIN inventory.brand brn ON P.brand_id = brn.ID
            WHERE sip.product_status = 1
            GROUP BY
            sip.product_id,
            P.name,
            cat.NAME,
            cat.id,
            brn.NAME,
            P.model_no,
            sip.price,
            p.sale_price,
            P.description,
            P.barcode,
            P.image,
            sip.store_id
            ORDER BY
            sip.store_id) sale_product_view

        </createView>

    </changeSet>
</databaseChangeLog>